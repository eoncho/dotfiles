<VirtualHost *:443>
  ServerName local.ei-front.economic-index.jp
  # !!! Be sure to point DocumentRoot to 'public'!
  DocumentRoot /var/www/ei-front/current/public    

  LogFormat "%h %l %u [%{%Y-%m-%d %H:%M:%S %z}t] \"%r\" %>s %b %D \"%{Referer}i\" \"%{User-Agent}i\"" custom
  SetEnvIf Request_URI "\.(css|js|gif|jpg|jpeg|png|ico|woff)$" nolog
  SetEnvIf Request_URI "^/static/.*$" nolog
  ErrorLog /var/log/httpd/ei-front-error_log
  CustomLog /var/log/httpd/ei-front-access_log custom env=!nolog
  <Directory /var/www/ei-front/current/public>
     # This relaxes Apache security settings.
     AllowOverride all
     # MultiViews must be turned off.
     Options -MultiViews
  </Directory>
  <Directory /var/www/ei-front/current/public/tmp>
     # This relaxes Apache security settings.
     AllowOverride all
     # MultiViews must be turned off.
     Options -MultiViews
  </Directory>

  SSLEngine on
  SSLCertificateFile /etc/pki/tls/certs/localhost.crt
  SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

  CustomLog logs/ssl_request_log "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"

  RequestHeader set X_FORWARDED_PROTO 'https'
  ProxyPass /assets/ !
  ProxyPass /static/ !
  ProxyPass /favicon.ico !
  ProxyPassMatch /(.*).(html|txt|xml)$ !
  ProxyPass / http://localhost:5000/
  ProxyPassReverse / http://localhost:5000/

  <Location />
     AuthUserFile /etc/httpd/conf/.htpasswd
     AuthName "Redmine"
     AuthType Basic
     Require valid-user
  </Location>
</VirtualHost>

